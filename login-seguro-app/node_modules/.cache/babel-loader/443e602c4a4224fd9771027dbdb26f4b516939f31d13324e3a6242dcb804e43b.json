{"ast":null,"code":"import React,{useState}from'react';import{useNavigate}from'react-router-dom';import{Box,Button,Container,FormControl,FormLabel,Input,VStack,Heading,useToast,Alert,AlertIcon,AlertTitle,AlertDescription}from'@chakra-ui/react';import{supabase}from'../lib/supabaseClient';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export default function Login(){const[email,setEmail]=useState('');const[password,setPassword]=useState('');const[isLoading,setIsLoading]=useState(false);const[attempts,setAttempts]=useState(0);const[timeRemaining,setTimeRemaining]=useState(0);const navigate=useNavigate();const toast=useToast();const validateInput=input=>{const dangerousPatterns=[/SELECT.*FROM/i,/INSERT.*INTO/i,/UPDATE.*SET/i,/DELETE.*FROM/i,/<script>/i,/'/,/;/,/--/];return!dangerousPatterns.some(pattern=>pattern.test(input));};const handleSubmit=async e=>{e.preventDefault();if(timeRemaining>0){toast({title:'Cuenta bloqueada',description:`Por favor espere ${Math.floor(timeRemaining/60)}:${(timeRemaining%60).toString().padStart(2,'0')} minutos`,status:'error',duration:5000});return;}if(!validateInput(email)||!validateInput(password)){toast({title:'Error de Seguridad',description:'Entrada inválida detectada - Se ha registrado el intento',status:'error',duration:3000});return;}setIsLoading(true);try{const{data,error}=await supabase.auth.signInWithPassword({email,password});if(error)throw error;if(data.user){toast({title:'Inicio de sesión exitoso',status:'success',duration:2000});// Redirigir al perfil después de un inicio de sesión exitoso\nnavigate('/profile');}}catch(error){const newAttempts=attempts+1;setAttempts(newAttempts);if(newAttempts>=3){const lockoutMinutes=15;setTimeRemaining(lockoutMinutes*60);const lockoutInterval=setInterval(()=>{setTimeRemaining(prev=>{if(prev<=1){clearInterval(lockoutInterval);setAttempts(0);return 0;}return prev-1;});},1000);}toast({title:'Error',description:error.message,status:'error',duration:3000});}finally{setIsLoading(false);}};return/*#__PURE__*/_jsx(Container,{maxW:\"container.sm\",py:10,children:/*#__PURE__*/_jsxs(VStack,{spacing:8,children:[/*#__PURE__*/_jsx(Heading,{children:\"Login Seguro\"}),timeRemaining>0&&/*#__PURE__*/_jsxs(Alert,{status:\"error\",borderRadius:\"md\",children:[/*#__PURE__*/_jsx(AlertIcon,{}),/*#__PURE__*/_jsxs(Box,{children:[/*#__PURE__*/_jsx(AlertTitle,{children:\"Cuenta bloqueada\"}),/*#__PURE__*/_jsxs(AlertDescription,{children:[\"Por favor espere \",Math.floor(timeRemaining/60),\":\",(timeRemaining%60).toString().padStart(2,'0'),\" minutos\"]})]})]}),/*#__PURE__*/_jsx(Box,{w:\"100%\",bg:\"white\",p:8,borderRadius:\"lg\",boxShadow:\"lg\",children:/*#__PURE__*/_jsx(\"form\",{onSubmit:handleSubmit,children:/*#__PURE__*/_jsxs(VStack,{spacing:4,children:[/*#__PURE__*/_jsxs(FormControl,{isRequired:true,children:[/*#__PURE__*/_jsx(FormLabel,{children:\"Email\"}),/*#__PURE__*/_jsx(Input,{type:\"email\",value:email,onChange:e=>setEmail(e.target.value),bg:\"gray.50\",isDisabled:timeRemaining>0})]}),/*#__PURE__*/_jsxs(FormControl,{isRequired:true,children:[/*#__PURE__*/_jsx(FormLabel,{children:\"Contrase\\xF1a\"}),/*#__PURE__*/_jsx(Input,{type:\"password\",value:password,onChange:e=>setPassword(e.target.value),bg:\"gray.50\",isDisabled:timeRemaining>0})]}),attempts>0&&attempts<3&&/*#__PURE__*/_jsxs(Alert,{status:\"warning\",children:[/*#__PURE__*/_jsx(AlertIcon,{}),/*#__PURE__*/_jsxs(AlertDescription,{children:[\"Intentos fallidos: \",attempts,\"/3\"]})]}),/*#__PURE__*/_jsx(Button,{type:\"submit\",colorScheme:\"blue\",width:\"full\",isLoading:isLoading,isDisabled:timeRemaining>0,children:\"Ingresar\"})]})})})]})});}","map":{"version":3,"names":["React","useState","useNavigate","Box","Button","Container","FormControl","FormLabel","Input","VStack","Heading","useToast","Alert","AlertIcon","AlertTitle","AlertDescription","supabase","jsx","_jsx","jsxs","_jsxs","Login","email","setEmail","password","setPassword","isLoading","setIsLoading","attempts","setAttempts","timeRemaining","setTimeRemaining","navigate","toast","validateInput","input","dangerousPatterns","some","pattern","test","handleSubmit","e","preventDefault","title","description","Math","floor","toString","padStart","status","duration","data","error","auth","signInWithPassword","user","newAttempts","lockoutMinutes","lockoutInterval","setInterval","prev","clearInterval","message","maxW","py","children","spacing","borderRadius","w","bg","p","boxShadow","onSubmit","isRequired","type","value","onChange","target","isDisabled","colorScheme","width"],"sources":["/Users/Lenovo/Documents/GitHub/loginseguro/login-seguro-app/src/components/Login.tsx"],"sourcesContent":["import React, { useState } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport {\n  Box,\n  Button,\n  Container,\n  FormControl,\n  FormLabel,\n  Input,\n  VStack,\n  Heading,\n  useToast,\n  Alert,\n  AlertIcon,\n  AlertTitle,\n  AlertDescription,\n} from '@chakra-ui/react';\nimport { supabase } from '../lib/supabaseClient';\n\nexport default function Login() {\n  const [email, setEmail] = useState('');\n  const [password, setPassword] = useState('');\n  const [isLoading, setIsLoading] = useState(false);\n  const [attempts, setAttempts] = useState(0);\n  const [timeRemaining, setTimeRemaining] = useState(0);\n  const navigate = useNavigate();\n  const toast = useToast();\n\n  const validateInput = (input: string) => {\n    const dangerousPatterns = [\n      /SELECT.*FROM/i,\n      /INSERT.*INTO/i,\n      /UPDATE.*SET/i,\n      /DELETE.*FROM/i,\n      /<script>/i,\n      /'/,\n      /;/,\n      /--/\n    ];\n    return !dangerousPatterns.some(pattern => pattern.test(input));\n  };\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    \n    if (timeRemaining > 0) {\n      toast({\n        title: 'Cuenta bloqueada',\n        description: `Por favor espere ${Math.floor(timeRemaining / 60)}:${(timeRemaining % 60).toString().padStart(2, '0')} minutos`,\n        status: 'error',\n        duration: 5000,\n      });\n      return;\n    }\n\n    if (!validateInput(email) || !validateInput(password)) {\n      toast({\n        title: 'Error de Seguridad',\n        description: 'Entrada inválida detectada - Se ha registrado el intento',\n        status: 'error',\n        duration: 3000,\n      });\n      return;\n    }\n\n    setIsLoading(true);\n    try {\n      const { data, error } = await supabase.auth.signInWithPassword({\n        email,\n        password,\n      });\n\n      if (error) throw error;\n\n      if (data.user) {\n        toast({\n          title: 'Inicio de sesión exitoso',\n          status: 'success',\n          duration: 2000,\n        });\n        // Redirigir al perfil después de un inicio de sesión exitoso\n        navigate('/profile');\n      }\n    } catch (error: any) {\n      const newAttempts = attempts + 1;\n      setAttempts(newAttempts);\n      \n      if (newAttempts >= 3) {\n        const lockoutMinutes = 15;\n        setTimeRemaining(lockoutMinutes * 60);\n        const lockoutInterval = setInterval(() => {\n          setTimeRemaining(prev => {\n            if (prev <= 1) {\n              clearInterval(lockoutInterval);\n              setAttempts(0);\n              return 0;\n            }\n            return prev - 1;\n          });\n        }, 1000);\n      }\n\n      toast({\n        title: 'Error',\n        description: error.message,\n        status: 'error',\n        duration: 3000,\n      });\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  return (\n    <Container maxW=\"container.sm\" py={10}>\n      <VStack spacing={8}>\n        <Heading>Login Seguro</Heading>\n        \n        {timeRemaining > 0 && (\n          <Alert status=\"error\" borderRadius=\"md\">\n            <AlertIcon />\n            <Box>\n              <AlertTitle>Cuenta bloqueada</AlertTitle>\n              <AlertDescription>\n                Por favor espere {Math.floor(timeRemaining / 60)}:{(timeRemaining % 60).toString().padStart(2, '0')} minutos\n              </AlertDescription>\n            </Box>\n          </Alert>\n        )}\n\n        <Box w=\"100%\" bg=\"white\" p={8} borderRadius=\"lg\" boxShadow=\"lg\">\n          <form onSubmit={handleSubmit}>\n            <VStack spacing={4}>\n              <FormControl isRequired>\n                <FormLabel>Email</FormLabel>\n                <Input\n                  type=\"email\"\n                  value={email}\n                  onChange={(e) => setEmail(e.target.value)}\n                  bg=\"gray.50\"\n                  isDisabled={timeRemaining > 0}\n                />\n              </FormControl>\n\n              <FormControl isRequired>\n                <FormLabel>Contraseña</FormLabel>\n                <Input\n                  type=\"password\"\n                  value={password}\n                  onChange={(e) => setPassword(e.target.value)}\n                  bg=\"gray.50\"\n                  isDisabled={timeRemaining > 0}\n                />\n              </FormControl>\n\n              {attempts > 0 && attempts < 3 && (\n                <Alert status=\"warning\">\n                  <AlertIcon />\n                  <AlertDescription>\n                    Intentos fallidos: {attempts}/3\n                  </AlertDescription>\n                </Alert>\n              )}\n\n              <Button\n                type=\"submit\"\n                colorScheme=\"blue\"\n                width=\"full\"\n                isLoading={isLoading}\n                isDisabled={timeRemaining > 0}\n              >\n                Ingresar\n              </Button>\n            </VStack>\n          </form>\n        </Box>\n      </VStack>\n    </Container>\n  );\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}